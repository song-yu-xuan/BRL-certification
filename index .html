<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·´è¥¿ CPF/CNPJ æ™ºèƒ½è¾“å…¥ç»„ä»¶ (åŠ¨æ€æ©ç ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        .transition-all-300 { transition: all 0.3s ease-in-out; }
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ (å¯é€‰) */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex items-center justify-center p-4 md:p-8">

    <!-- ä¸»å®¹å™¨ -->
    <div class="max-w-6xl w-full mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
        
        <!-- å·¦ä¾§/é¡¶éƒ¨ï¼šäº¤äº’ Demo å¡ç‰‡ -->
        <div class="w-full max-w-md mx-auto bg-white rounded-2xl shadow-xl p-8 border border-slate-100 sticky top-8">
            
            <!-- æ ‡é¢˜åŒºåŸŸ -->
            <div class="mb-8 text-center">
                <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-blue-50 mb-4 text-blue-600">
                    <i data-lucide="shield-check" class="w-6 h-6"></i>
                </div>
                <h1 class="text-2xl font-bold text-slate-800">Checkout Seguro</h1>
                <p class="text-slate-500 text-sm mt-1">è¯·è¾“å…¥æ‚¨çš„å·´è¥¿ç¨åŠ¡ç™»è®°å·ä»¥ç»§ç»­</p>
            </div>

            <!-- è¾“å…¥è¡¨å•ç»„ -->
            <div class="relative group">
                <label for="docInput" class="block text-sm font-medium text-slate-700 mb-2 ml-1">
                    CPF / CNPJ <span class="text-xs text-slate-400 font-normal">(è‡ªåŠ¨æ ¼å¼åŒ–å±•ç¤º)</span>
                </label>

                <div class="relative">
                    <input 
                        type="tel" 
                        id="docInput" 
                        maxlength="18"
                        placeholder="000.000.000-00"
                        class="w-full pl-4 pr-12 py-3.5 bg-slate-50 border-2 border-slate-200 rounded-xl text-lg tracking-wide text-slate-800 outline-none focus:bg-white transition-all-300 placeholder:text-slate-300 font-mono"
                    >
                    
                    <div class="absolute right-4 top-1/2 -translate-y-1/2 flex items-center pointer-events-none">
                        <i data-lucide="credit-card" id="icon-default" class="w-5 h-5 text-slate-400 transition-opacity duration-300"></i>
                        <i data-lucide="check-circle-2" id="icon-success" class="w-6 h-6 text-emerald-500 opacity-0 absolute transition-opacity duration-300 scale-75"></i>
                        <i data-lucide="alert-circle" id="icon-error" class="w-6 h-6 text-red-500 opacity-0 absolute transition-opacity duration-300 scale-75"></i>
                    </div>
                </div>

                <!-- åº•éƒ¨åé¦ˆä¿¡æ¯ -->
                <div class="flex justify-between items-start mt-2 px-1 h-6">
                    <span id="feedback-msg" class="text-xs font-medium text-slate-400 transition-colors duration-300">
                        è¯·è¾“å…¥ 11 ä½ CPF æˆ– 14 ä½ CNPJ
                    </span>
                    <span id="type-badge" class="hidden text-[10px] font-bold uppercase tracking-wider px-2 py-0.5 rounded bg-slate-100 text-slate-500">
                        æœªçŸ¥
                    </span>
                </div>
            </div>

            <button id="submitBtn" disabled class="w-full mt-8 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 disabled:cursor-not-allowed text-white font-semibold py-3.5 rounded-xl shadow-lg shadow-blue-500/30 disabled:shadow-none transition-all duration-300 transform active:scale-[0.98]">
                ç¡®è®¤æ”¯ä»˜
            </button>

            <!-- æµ‹è¯•å·¥å…· -->
            <div class="mt-10 pt-6 border-t border-dashed border-slate-200">
                <p class="text-xs text-center text-slate-400 mb-3">ğŸ›  æµ‹è¯•è¾…åŠ©å·¥å…· (ç‚¹å‡»ç”Ÿæˆ)</p>
                <div class="flex gap-3 justify-center">
                    <button onclick="fillRandom('cpf')" class="px-3 py-1.5 text-xs font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors">ç”Ÿæˆ CPF</button>
                    <button onclick="fillRandom('cnpj')" class="px-3 py-1.5 text-xs font-medium text-purple-600 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors">ç”Ÿæˆ CNPJ</button>
                    <button onclick="fillRandom('blacklist')" class="px-3 py-1.5 text-xs font-medium text-red-600 bg-red-50 hover:bg-red-100 rounded-lg transition-colors">ç”Ÿæˆé»‘åå•å·</button>
                </div>
                <div class="mt-4 p-3 bg-slate-100 rounded text-xs font-mono text-slate-600 break-all">
                    <span class="font-bold text-slate-400">æ¨¡æ‹Ÿä¸Šé€å­—æ®µ(Pure Data):</span><br>
                    <span id="debug-payload" class="text-blue-600 font-bold">-</span>
                </div>
            </div>
        </div>

        <!-- å³ä¾§/åº•éƒ¨ï¼šåŠŸèƒ½äº®ç‚¹è¯´æ˜ -->
        <div class="space-y-6 lg:pl-4">
            <div class="mb-4">
                <h2 class="text-xl font-bold text-slate-800">æ ¸å¿ƒåŠŸèƒ½äº®ç‚¹</h2>
                <p class="text-slate-500 text-sm">Fintech çº§åˆ«çš„è¡¨å•äº¤äº’ä½“éªŒè®¾è®¡</p>
            </div>

            <!-- åŠŸèƒ½åˆ—è¡¨ -->
            <div class="grid gap-4">
                <!-- Feature 1 -->
                <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex gap-4">
                        <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-indigo-50 flex items-center justify-center text-indigo-600">
                            <i data-lucide="combine" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-slate-800 text-sm">æ™ºèƒ½äºŒåˆä¸€è¾“å…¥ (Hybrid Input)</h3>
                            <p class="text-xs text-slate-500 mt-1 leading-relaxed">
                                æ— éœ€åˆ‡æ¢å•é€‰æ¡†ã€‚å•è¾“å…¥æ¡†åŒæ—¶æ”¯æŒ 11ä½ä¸ªäººç¨å·(CPF) å’Œ 14ä½ä¼ä¸šç¨å·(CNPJ)ï¼Œæ ¹æ®è¾“å…¥é•¿åº¦è‡ªåŠ¨æ— ç¼åˆ‡æ¢æ¨¡å¼ã€‚
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Feature 2 -->
                <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex gap-4">
                        <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center text-blue-600">
                            <i data-lucide="wand-2" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-slate-800 text-sm">åŠ¨æ€è¾“å…¥æ©ç  (Dynamic Masking)</h3>
                            <p class="text-xs text-slate-500 mt-1 leading-relaxed">
                                <span class="font-bold text-blue-600"></span>
                                ç”¨æˆ·åªéœ€è¾“å…¥æ•°å­— <code>123456...</code>ï¼Œå‰ç«¯è‡ªåŠ¨å°†å…¶æ ¼å¼åŒ–ä¸º <code>123.456.789-00</code> å±•ç¤ºç»™ç”¨æˆ·ï¼Œæå‡å¯è¯»æ€§ã€‚æ”¯æŒéšæ‰“éšæ˜¾ï¼Œç²˜è´´è‡ªåŠ¨æ¸…æ´—æ‚ä¹±å­—ç¬¦ã€‚
                            </p>
                        </div>
                    </div>
                </div>

                 <!-- Feature 3 -->
                 <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex gap-4">
                        <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-orange-50 flex items-center justify-center text-orange-600">
                            <i data-lucide="undo-2" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-slate-800 text-sm">æ™ºèƒ½å›é€€æœºåˆ¶ (Smart Revert)</h3>
                            <p class="text-xs text-slate-500 mt-1 leading-relaxed">
                                <span class="font-bold text-orange-600"></span>
                                å³ä½¿å·²è¾“å…¥åˆ° CNPJ æ¨¡å¼(12ä½)ï¼Œä¸€æ—¦åˆ é™¤å›é€€è‡³ 11ä½ï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­ä¸ºâ€œè¾“é”™â€ï¼Œç«‹å³åˆ‡å› CPF æ ¼å¼ï¼Œé¿å…ç”¨æˆ·å¡æ­»åœ¨ä¼ä¸šå·æ¨¡å¼ã€‚
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Feature 4 -->
                <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex gap-4">
                        <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-emerald-50 flex items-center justify-center text-emerald-600">
                            <i data-lucide="verified" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-slate-800 text-sm">ç®—æ³•çº§å³æ—¶æ ¡éªŒ (Real-time Validation)</h3>
                            <p class="text-xs text-slate-500 mt-1 leading-relaxed">
                                å†…ç½®å·´è¥¿å®˜æ–¹ <strong>Modulo 11</strong> ç®—æ³•ã€‚å®æ—¶æ‹¦æˆªæ— æ•ˆæ ¡éªŒä½ã€æ‹¦æˆªé»‘åå•å·ç  (å¦‚ 111.111...)ï¼Œå³æ—¶åé¦ˆæå‡é€šè¿‡ç‡ã€‚
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-center pt-4">
                <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-slate-100 text-[10px] font-medium text-slate-500 uppercase tracking-wide">
                    <i data-lucide="smartphone" class="w-3 h-3"></i> Mobile Optimized
                </span>
            </div>
        </div>

    </div>

    <script>
        lucide.createIcons();

        const input = document.getElementById('docInput');
        const feedbackMsg = document.getElementById('feedback-msg');
        const iconDefault = document.getElementById('icon-default');
        const iconSuccess = document.getElementById('icon-success');
        const iconError = document.getElementById('icon-error');
        const typeBadge = document.getElementById('type-badge');
        const submitBtn = document.getElementById('submitBtn');
        const debugPayload = document.getElementById('debug-payload');

        // --- æ ¸å¿ƒäº‹ä»¶ç›‘å¬ ---

        input.addEventListener('input', function(e) {
            const rawValue = e.target.value;
            
            // 1. è·å–çº¯æ•°å­— (æ¸…æ´—)
            // è¿™é‡Œä¼šæŠŠæ‰€æœ‰çš„ . - / ç­‰éæ•°å­—ç¬¦å·å»æ‰
            let cleanValue = rawValue.replace(/\D/g, '');
            
            // 2. é™åˆ¶æœ€å¤§é•¿åº¦ (CNPJ 14ä½)
            if (cleanValue.length > 14) cleanValue = cleanValue.slice(0, 14);

            // 3. æ™ºèƒ½å›é€€ä¸æ„å›¾åˆ¤æ–­ (ä¸ä½¿ç”¨ä¸»åŠ¨æ„å›¾é¢„æµ‹ï¼Œåªæ ¹æ®é•¿åº¦å’Œå›é€€)
            // ä»…ä»…ä¾èµ–é•¿åº¦ > 11 æ¥åˆ¤æ–­æ˜¯å¦ä¸º CNPJ æ¨¡å¼ã€‚
            // æ™ºèƒ½å›é€€æœºåˆ¶ï¼šå½“ç”¨æˆ·åˆ æ‰ç¬¬12ä½ï¼ŒcleanValueå˜æˆ11ä½ï¼ŒisCNPJè‡ªåŠ¨å˜ä¸ºfalseï¼Œformatterè‡ªåŠ¨åˆ‡å›CPFã€‚
            let isCNPJ = cleanValue.length > 11;

            // 4. åº”ç”¨æ©ç  (æ ¸å¿ƒé€»è¾‘)
            let maskedValue = applyMask(cleanValue, isCNPJ);
            
            // 5. å°†æ ¼å¼åŒ–åçš„å€¼å›å¡«ç»™ inputï¼Œå±•ç¤ºç»™ç”¨æˆ·
            e.target.value = maskedValue;

            // 6. æ›´æ–°è°ƒè¯•é¢æ¿ (å±•ç¤ºå®é™…ä¸Šé€çš„æ•°æ®)
            debugPayload.textContent = cleanValue;

            // 7. æ ¡éªŒä¸æ¸²æŸ“
            validateAndRender(cleanValue, isCNPJ);
        });

        // --- æ ¸å¿ƒåŠŸèƒ½å‡½æ•° ---

        function applyMask(value, isCNPJ) {
            if (!value) return "";
            
            if (!isCNPJ) {
                // CPF Mask: 000.000.000-00
                // é€æ­¥æ›¿æ¢ï¼Œæå‡è¾“å…¥ä½“éªŒ
                return value
                    .replace(/(\d{3})(\d)/, '$1.$2')
                    .replace(/(\d{3})(\d)/, '$1.$2')
                    .replace(/(\d{3})(\d{1,2})/, '$1-$2')
                    .replace(/(-\d{2})\d+?$/, '$1');
            } else {
                // CNPJ Mask: 00.000.000/0000-00
                return value
                    .replace(/^(\d{2})(\d)/, '$1.$2')
                    .replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3')
                    .replace(/\.(\d{3})(\d)/, '.$1/$2')
                    .replace(/(\d{4})(\d)/, '$1-$2')
                    .replace(/(-\d{2})\d+?$/, '$1');
            }
        }

        function validateAndRender(cleanValue, isCNPJ) {
            const length = cleanValue.length;
            let isValid = false;
            let type = '';
            
            if (length === 0) {
                resetUI();
                return;
            }

            if (isCNPJ) {
                type = 'CNPJ';
                if (length < 14) {
                    setStatus('neutral', `è¿˜éœ€è¾“å…¥ ${14 - length} ä½æ•°å­—`, type);
                    return;
                }
                isValid = validateCNPJ(cleanValue);
            } else {
                type = 'CPF';
                // å½“é•¿åº¦æ°å¥½ä¸º11ä½æ—¶è¿›è¡Œæ ¡éªŒ
                if (length < 11) {
                    setStatus('neutral', `è¿˜éœ€è¾“å…¥ ${11 - length} ä½æ•°å­—`, type);
                    return;
                }
                isValid = validateCPF(cleanValue);
            }

            if (isValid) {
                setStatus('success', `${type} æœ‰æ•ˆ`, type);
            } else {
                // ç‰¹æ®Šé”™è¯¯æ–‡æ¡ˆå¤„ç†ï¼šå¦‚æœæ˜¯é»‘åå•æˆ–æ ¡éªŒä½é”™è¯¯
                if (isBlacklisted(cleanValue)) {
                    setStatus('error', `${type} æ— æ•ˆ (é»‘åå•å·ç )`, type);
                } else {
                    setStatus('error', `${type} æ— æ•ˆï¼Œè¯·æ£€æŸ¥æ ¡éªŒä½`, type);
                }
            }
        }

        function setStatus(status, msg, typeText) {
            feedbackMsg.textContent = msg;
            typeBadge.textContent = typeText;
            typeBadge.classList.remove('hidden');
            
            input.classList.remove('border-slate-200', 'border-red-500', 'border-emerald-500', 'focus:ring-blue-100', 'focus:border-blue-500');
            iconDefault.style.opacity = '0';
            iconSuccess.style.opacity = '0';
            iconError.style.opacity = '0';
            iconSuccess.classList.remove('scale-100');
            iconError.classList.remove('scale-100');

            if (status === 'success') {
                input.classList.add('border-emerald-500', 'focus:ring-emerald-100', 'focus:border-emerald-500', 'text-emerald-700', 'bg-emerald-50/30');
                feedbackMsg.className = 'text-xs font-medium text-emerald-600 transition-colors duration-300';
                typeBadge.className = 'text-[10px] font-bold uppercase tracking-wider px-2 py-0.5 rounded bg-emerald-100 text-emerald-600';
                iconSuccess.style.opacity = '1';
                iconSuccess.classList.add('scale-100');
                submitBtn.disabled = false;
            } else if (status === 'error') {
                input.classList.add('border-red-500', 'focus:ring-red-100', 'focus:border-red-500', 'text-red-700', 'bg-red-50/30');
                feedbackMsg.className = 'text-xs font-medium text-red-500 transition-colors duration-300';
                typeBadge.className = 'text-[10px] font-bold uppercase tracking-wider px-2 py-0.5 rounded bg-red-100 text-red-600';
                iconError.style.opacity = '1';
                iconError.classList.add('scale-100');
                submitBtn.disabled = true;
            } else {
                input.classList.add('border-slate-200', 'focus:ring-blue-100', 'focus:border-blue-500', 'text-slate-800');
                feedbackMsg.className = 'text-xs font-medium text-blue-500 transition-colors duration-300';
                typeBadge.className = 'text-[10px] font-bold uppercase tracking-wider px-2 py-0.5 rounded bg-slate-100 text-slate-500';
                iconDefault.style.opacity = '1';
                submitBtn.disabled = true;
            }
        }

        function resetUI() {
            input.classList.remove('text-emerald-700', 'bg-emerald-50/30', 'text-red-700', 'bg-red-50/30');
            input.classList.add('text-slate-800');
            feedbackMsg.textContent = 'è¯·è¾“å…¥ 11 ä½ CPF æˆ– 14 ä½ CNPJ';
            typeBadge.classList.add('hidden');
            iconDefault.style.opacity = '1';
            iconSuccess.style.opacity = '0';
            iconError.style.opacity = '0';
            input.classList.add('border-slate-200');
            debugPayload.textContent = '-';
        }

        // --- æ ¸å¿ƒæ ¡éªŒç®—æ³• (Modulo 11) ---

        // é»‘åå•æ£€æŸ¥
        function isBlacklisted(val) {
            return /^(\d)\1+$/.test(val);
        }

        function validateCPF(cpf) {
            if (isBlacklisted(cpf)) return false;
            let sum = 0, remainder;
            for (let i = 1; i <= 9; i++) sum = sum + parseInt(cpf.substring(i-1, i)) * (11 - i);
            remainder = (sum * 10) % 11;
            if (remainder === 10 || remainder === 11) remainder = 0;
            if (remainder !== parseInt(cpf.substring(9, 10))) return false;
            sum = 0;
            for (let i = 1; i <= 10; i++) sum = sum + parseInt(cpf.substring(i-1, i)) * (12 - i);
            remainder = (sum * 10) % 11;
            if (remainder === 10 || remainder === 11) remainder = 0;
            return remainder === parseInt(cpf.substring(10, 11));
        }

        function validateCNPJ(cnpj) {
            if (isBlacklisted(cnpj)) return false;
            const calc = (x) => {
                const slice = cnpj.substring(0, x);
                let sum = 0, pos = x - 7;
                for (let i = x; i >= 1; i--) {
                    sum += slice.charAt(x - i) * pos--;
                    if (pos < 2) pos = 9;
                }
                return sum % 11 < 2 ? 0 : 11 - sum % 11;
            };
            return calc(12) === parseInt(cnpj.charAt(12)) && calc(13) === parseInt(cnpj.charAt(13));
        }

        // --- æµ‹è¯•å·¥å…· ---
        function fillRandom(type) {
            const rnd = (n) => Math.round(Math.random() * n);
            const mod = (a, b) => Math.round(a - (Math.floor(a / b) * b));
            
            if (type === 'blacklist') {
                const num = Math.floor(Math.random() * 9) + 1; // 1-9
                const val = String(num).repeat(11);
                // æ¨¡æ‹Ÿç²˜è´´æˆ–è¾“å…¥ï¼Œé€šè¿‡ Event è§¦å‘ input ç›‘å¬
                input.value = val;
                input.dispatchEvent(new Event('input'));
                return;
            }

            if (type === 'cpf') {
                const n = Array.from({length: 9}, () => rnd(9));
                let d1 = n.reduce((acc, curr, i) => acc + curr * (10-i), 0);
                d1 = 11 - mod(d1, 11); if (d1 >= 10) d1 = 0;
                let d2 = n.reduce((acc, curr, i) => acc + curr * (11-i), 0) + d1*2;
                d2 = 11 - mod(d2, 11); if (d2 >= 10) d2 = 0;
                const val = n.join('') + d1 + d2;
                input.value = val;
                input.dispatchEvent(new Event('input'));
            } else {
                const n = Array.from({length: 8}, () => rnd(9));
                const b = [0,0,0,1]; // 0001
                const base = [...n, ...b];
                const calcD = (arr, startW) => {
                    let s = 0;
                    let w = startW;
                    for(let i=0; i < arr.length; i++) {
                        s += arr[i] * w;
                        w--;
                        if(w < 2) w = 9;
                    }
                    const r = s % 11;
                    return r < 2 ? 0 : 11 - r;
                };
                const d1 = calcD(base, 5);
                const d2 = calcD([...base, d1], 6);
                const val = base.join('') + d1 + d2;
                input.value = val;
                input.dispatchEvent(new Event('input'));
            }
        }
    </script>
</body>
</html>